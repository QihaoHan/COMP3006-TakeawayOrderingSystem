<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="Maidong">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">
    <!-- 兼容IOS9 -->
    <title>Takeaway Ordering System</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/car.css">
    <link rel="stylesheet" type="text/css" media="all" href="/css/style.css">
      <style>
          .custom-carousel {
              width: 10%;  /* 调整宽度为原来的一半 */
              margin: 0 auto; /* 居中显示 */
          }

          .carousel-inner img {
              width: 100%; /* 让图片填满轮播图容器 */
              height: auto; /* 自动调整图片的高度 */
          }

          @keyframes slide-in-out {
              0% {
                  transform: translateX(-100%); /* 从左边外部开始 */
                  opacity: 0;
              }
              25% {
                  transform: translateX(0); /* 进入视图区域 */
                  opacity: 1;
              }
              75% {
                  transform: translateX(0); /* 停留在视图区域 */
                  opacity: 1;
              }
              100% {
                  transform: translateX(100%); /* 向右边外部移动并消失 */
                  opacity: 0;
              }
          }

          .carousel-item {
              animation: slide-in-out 6s ease-in-out infinite;
          }

          #floating-image-container {
              position: fixed;
              left: 10px; /* 调整到页面左侧的位置 */
              top: 50%;  /* 定位到视口的垂直中心 */
              transform: translateY(-50%); /* 确保容器垂直居中 */
              z-index: 100; /* 确保它在其他内容之上 */
          }

          #floating-image-container img {
              width: 800px; /* 调整图片大小 */
              animation: float-animation 3s ease-in-out infinite;
          }

          @keyframes float-animation {
              0%, 100% { transform: translateY(0); }
              50% { transform: translateY(-20px); }
          }
      </style>


      .carousel-item {
              animation: float-horizontal 3s ease-in-out infinite;
          }
      </style>

          .carousel-item {
              animation: fade-slide 3s ease-in-out;
          }
      </style>

  </head>
    <style>
      .mir-shadow{ box-shadow: 10px 10px 15px #8e8e8e; }
      #gotoTop{ position: fixed; bottom: 10px; right: 10px; width: 50px; height: 50px; opacity: 0.5; }
      #gotoTop:hover{ opacity: 1; }
      .erweima {
        position:fixed;
        left: 0;
        top: 0;
        width:100%;
        height:100%;
        background-color: rgba(0, 0, 0, 0.5);
        text-align:center;
        overflow: hidden;
        display: none;
        justify-content: center;
        -webkit-align-items: center;
        align-items: center;
        z-index: 999;
      }
      .md-media {
        display: -webkit-flex;
        display: flex;
        -webkit-align-items: center;
        align-items: center;
      }
      .erweima img {
        opacity: 1;
      }
      .nav-link:hover{background-color: yellow;color: black;}
    </style>
  <body>
    <% include ../template/header.html %>
    <main>

        <!-- Bootstrap 轮播图 -->
        <div id="carouselExampleIndicators" class="carousel slide custom-carousel" data-ride="carousel">
            <!-- 指示器 -->
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <!-- 轮播图内容 -->
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="/img/1.png" alt="First slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/2.png" alt="Second slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/3.png" alt="Third slide">
                </div>

            </div>

            <!-- 控制器 -->
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
      <section class="jumbotron mb-0">
        <div class="container">
          <div class="row">
            <div class="col-12 col-sm-12 col-md-3 text-center">
              <img src="/img/logo.png" alt="logo" id="logo">
            </div>
            <div class="col-12 col-sm-12 col-md-4 offset-md-1">
              <h1 class="mb-5">Pulse Takeaway Ordering System</h1>
              <p>
                  Pulse Takeout Ordering System is a system that specializes in selling fried chicken burgers
              </p>
            </div>
            <div class="col-md-4">
                <center><h1 class="mb-5"><span id="user_state">User status: Not logged in</span></h1></center>
                <center class="mb-3" id="logincenter"><a href="#loginmodal" class="flatbtn" id="logintrigger">Login / Registe</a></center>
                <center class="mb-3" id="logoutcenter" style="display: none;"><a class="flatbtn">Logout</a></center>
            </div>
          </div>
        </div>
      </section>
      <div class="py-5 bg-light">
        <div class="container" id="main_container">
          <div class="row" id="dishes">


<!--             <div class="col-12 col-sm-12 col-md-4" id="item_0">
            <div class="card mb-4 mt-4 box-shadow mir-shadow">
            <img class="card-img-top" src="/img/1.jpg" alt="Card image cap">
            <div class="card-body">
            <p class="card-text">麻辣鸡丝</p>
            <nav class="nav nav-pills nav-fill">
            <a class="nav-item nav-link" href="javascript:(0);" name="xiazai">添加到购物车</a>
            </nav>
            </div>
            </div>
            </div> -->


            </div>
          </div>
        </div>
      </div>

    <div id="car">
        <div id="dnum">0</div>
    </div>



    <div id="loginmodal" style="display:none;">
        <h1>User Login / Registe</h1>
        <form id="loginform" name="loginform" method="post" action="index.html">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" class="txtfield" tabindex="1">
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" class="txtfield" tabindex="2">
            <div class="center"><input type="button" name="loginbtn" id="loginbtn" class="flatbtn-blu hidemodal mr-3" value="Log In" tabindex="3"><input type="button" name="loginbtn" id="registebtn" class="flatbtn-blu hidemodal" value="Registe" tabindex="3"></div>
        </form>
    </div>


    </main>
    <% include ../template/footer.html %>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="/js/jquery.leanModal.min.js"></script>
    <script src="/js/functions.js"></script>
    <script>
        $(document).ready(function(){
            $('.carousel').carousel({
                interval: 2000 // 轮播图切换的时间间隔，单位为毫秒
            });
        });
    </script>
    <script>
        "use strict";
        var iNum = 0;
        var dishes = null;
        var LOGIN = false;
        $(function(){
              $.ajax('http://localhost:8081/dishes',{
                           data:{
                              "dishes":"dishes"
                          },
                           dataType:'json',
                           type:'POST',
                           async:'true',
                           success:function(result){
                               console.log(result)
                               if(result.status!='200')
                               {
                                   return;
                               }
                               loadHTML(result.data);
                              addEventsListeners();
                           },
                           error:function(){
                               alert("error");
                               }
                       });
            console.log(document.cookie);
            if(getCookie('username') != null && getCookie('password') != null) {

              $.ajax('http://localhost:8081/login',{
                           data:{
                              "username":getCookie('username'),
                              "password":getCookie('password')
                          },
                           dataType:'json',
                           type:'POST',
                           async:'true',
                           success:function(result){
                               console.log(result)
                               if(result.status!='200')
                               {
                                   return;
                               }
                               if(result.data.success == true) {
                                $('#user_state').text('Current User:' + result.data.username);
                                $('#logincenter').hide();
                                $('#logoutcenter').show();
                                LOGIN = true;
                               } else {
                                $('#user_state').text('User status: Not logged in');
                                $('#logincenter').show();
                                $('#logoutcenter').hide();
                                LOGIN = false;
                               }
                              
                           },
                           error:function(){
                               alert("error");
                               }
                       });
            }
            
            $('#loginform').submit(function(e){return false;});
            $('#loginbtn').click(function(){
                console.log({
                                "username":$("#username").val(),
                                "password":$("#password").val()
                            });
                $.ajax('http://localhost:8081/login',{
                             data:{
                                "username":$("#username").val(),
                                "password":$("#password").val()
                            },
                             dataType:'json',
                             type:'POST',
                             async:'true',
                             success:function(result){
                                 console.log(result)
                                 if(result.status!='200')
                                 {
                                     return;
                                 }
                                 if(result.data.success == true) {
                                  $('#user_state').text('current user：' + result.data.username);
                                  $('#logincenter').hide();
                                  $('#logoutcenter').show();
                                  LOGIN = true;
                                 } else {
                                  $('#user_state').text('Login failed, wrong password');
                                  $('#logincenter').show();
                                  $('#logoutcenter').hide();
                                  LOGIN = false;
                                 }
                                
                             },
                             error:function(){
                                 alert("error");
                                 }
                         });
                $("#username").val(''); 
                $("#password").val(''); 
              });
            $('#registebtn').click(function(){
                $.ajax('http://localhost:8081/registe',{
                             data:{
                                "username":$("#username").val(),
                                "password":$("#password").val()
                            },
                             dataType:'json',
                             type:'POST',
                             async:'true',
                             success:function(result){
                                 console.log(result)
                                 if(result.status!='200')
                                 {
                                     return;
                                 }
                                 if(result.data.success) {
                                  $("#user_state").text("Successful registration");
                                 } else {
                                  $("#user_state").text("User already exists");
                                 }
                                
                             },
                             error:function(){
                                 alert("error");
                                 }
                         });
                $("#username").val(''); 
                $("#password").val(''); 
            });
            $('#logoutcenter').click(function(){
                delCookie("username");
                delCookie("password");
                $('#user_state').text('User status: Not logged in');
                $('#logincenter').show();
                $('#logoutcenter').hide();
                LOGIN = false;
                $.ajax('http://localhost:8081/logout',{
                             data:{
                                "logout":"logout"
                            },
                             dataType:'json',
                             type:'POST',
                             async:'true',
                             success:function(result){
                                 console.log(result);
                                 if(result.status!='200') 
                                 {
                                     return;
                                 }
                                
                             },
                             error:function(){
                                 alert("error");
                                 }
                         });
            });

            $('#logintrigger').leanModal({ top: 110, overlay: 0.45, closeButton: ".hidemodal" });
            $('#registetrigger').leanModal({ top: 110, overlay: 0.45, closeButton: ".hidemodal" });
            $("#car").click(function(){
              window.location.href = '/order';
            });
        });

function loadHTML(data) {
    dishes = data;
    $("#dishes").html("");
    var content = "";
    for(var item in data) {
        content += '<div class="col-12 col-sm-12 col-md-4" id="item_0">';
        content += '<div class="card mb-4 mt-4 box-shadow mir-shadow">';
        content += '<img class="card-img-top" src="/img/'+data[item].name+'.jpg" alt="Card image cap">';
        // content += '<img class="card-img-top" src="/img/'+data[item].name+'.jpg" alt="Card image cap">';
        content += '<div class="card-body">';
        content += '<div class="row mb-3">';
        content += '<div class="col-md-6"><p class="card-text">Name of the dish:'+data[item].name+'</p></div>';
        content += '<div class="col-md-6"><p class="card-text">Food Prices:'+data[item].price+'</p></div>';
        content += '</div>';
        content += '<nav class="nav nav-pills nav-fill">';
        content += '<a class="nav-item nav-link btn-car" href="javascript:(0);" name="'+data[item].name+'">Add to Cart</a>';
        content += '</nav>';
        content += '</div>';
        content += '</div>';
        content += '</div>';
    }
    $("#dishes").html(content);
}
function addEventsListeners() {
    for(var item in dishes) {
      if(getCookie(dishes[item].name) != null) {
        iNum = iNum + parseInt(getCookie(dishes[item].name));
      }
    }
    $("#dnum").text(iNum);
    $(".btn-car").click(function () {
        iNum++;
        var img = $(this).parent().parent().parent().find("img");
        var widthImg = img.width();
        var heightImg = img.height();
        var leftImg = img.offset().left;
        var topImg = img.offset().top;
        img.clone().appendTo($("body")).css({
            "left": leftImg,
            "top": topImg,
            "width": widthImg,
            "height": heightImg,
            "position": "absolute",
            "opacity": 0.8,
            "z-index": 10
        }).animate({
            "left": $("#car").offset().left,
            "top": $("#car").offset().top,
            "width": "30px",
            "height": "30px",
            "opacity": 0.2
        }, 1000, function () {
            $("#dnum").text(iNum);
            if(iNum != 0) {
              $("#car").css('background-image','url("../img/car_fill.png")');
            } else {
              $("#car").css('background-image','url("../img/car_empty.png")');
            }
            $(this).remove();
        });
        var num = getCookie($(this).attr('name'));
        if(num != null) {
            num = parseInt(num);
            setCookie($(this).attr('name') , num + 1);
        }
        else
        {
            setCookie($(this).attr('name'),'1');
        }
    });
  }
    </script>
  </body>
</html>
